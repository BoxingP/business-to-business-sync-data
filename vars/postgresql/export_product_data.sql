COPY (WITH constant_1 AS (VALUES (NOW() - INTERVAL '%s HOURS')), constant_2 AS (VALUES (%s)) SELECT sku, NULL AS list_price, discontinued, business_unit FROM product WHERE discontinued = TRUE AND updated_date >= (table constant_1) UNION SELECT p.sku, (CASE WHEN (table constant_2) THEN lp.list_price END) AS list_price, p.discontinued, p.business_unit FROM product AS p INNER JOIN list_price AS lp ON lp.sku = p.sku WHERE p.discontinued = FALSE AND (CASE WHEN (table constant_2) THEN lp.updated_date::TIMESTAMP::DATE = CURRENT_DATE ELSE p.updated_date >= (table constant_1) END) UNION SELECT p.sku, lp.list_price, p.discontinued, p.business_unit FROM product AS p INNER JOIN list_price AS lp ON lp.sku = p.sku WHERE (table constant_2) AND lp.effective_date::TIMESTAMP::DATE = CURRENT_DATE + 1) TO STDOUT WITH CSV DELIMITER ',' HEADER