COPY (WITH constant_1 AS (VALUES (TIMESTAMP %s)), constant_2 AS (VALUES (%s)) SELECT p.product, (CASE WHEN (p.discontinued) THEN NULL ELSE lp.list_price END) AS list_price, p.discontinued, p.business_unit FROM product p LEFT JOIN list_price AS lp ON lp.sku = p.product WHERE p.updated_date >= (table constant_1) UNION SELECT p.product, lp.list_price, p.discontinued, p.business_unit FROM product AS p INNER JOIN list_price AS lp ON lp.sku = p.product WHERE p.discontinued = FALSE AND lp.e1_updated_date >= (table constant_1) UNION SELECT p.product, lp.list_price, p.discontinued, p.business_unit FROM product AS p INNER JOIN list_price AS lp ON lp.sku = p.product WHERE (table constant_2) AND lp.effective_date::TIMESTAMP::DATE = CURRENT_DATE + 1) TO STDOUT WITH CSV DELIMITER ',' HEADER