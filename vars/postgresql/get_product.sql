SELECT p.{fields} FROM (SELECT NULL AS discontinued) dummy INNER JOIN LATERAL (SELECT product_id, product_type, business_unit, discontinued FROM {table}) p ON TRUE WHERE p.product_type = COALESCE(%(type)s, p.product_type) AND (p.discontinued = %(status)s OR %(status)s is NULL) AND (p.product_id IN %(products)s OR %(products)s is NULL) ORDER BY p.product_id;